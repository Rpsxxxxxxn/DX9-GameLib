//*************************************************************
//
// Bgm.hpp
//
// Bgmファイル読み込み用クラス
//
// Date: 2019/07/30 更新
//
//*************************************************************

#pragma once

//=============================================================
// インクルード
//=============================================================
#include "../../../Common.h"

//=============================================================
// クラス定義
//=============================================================
class CBgm
{
public:
	//-------------------------------------------------------------
	// コンストラクタ
	// 引　数：IXAudio2*	オーディオインターフェース
	// 　　　　string		ファイルパス
	//-------------------------------------------------------------
	CBgm(IXAudio2* pXAudio, string name);

	//-------------------------------------------------------------
	// デストラクタ
	//-------------------------------------------------------------
	~CBgm();

	//-------------------------------------------------------------
	// 初期化
	// 引　数：string	ファイルディレクトリ
	//-------------------------------------------------------------
	void Initialize(string name);

	//-------------------------------------------------------------
	// 更新
	//-------------------------------------------------------------
	void Update();

	//-------------------------------------------------------------
	// 開放
	//-------------------------------------------------------------
	void Release();

	//-------------------------------------------------------------
	// シーク
	//-------------------------------------------------------------
	bool Seek(int offset, int origin);

	//-------------------------------------------------------------
	// 再生
	//-------------------------------------------------------------
	void Play();

	//-------------------------------------------------------------
	// 停止
	//-------------------------------------------------------------
	void Stop();

	//-------------------------------------------------------------
	// 巻き戻し
	//-------------------------------------------------------------
	void Rewind();

	//-------------------------------------------------------------
	// ボリュームの設定
	// 引　数：float	音の大きさ
	//-------------------------------------------------------------
	void SetVolume(float volume);

	//-------------------------------------------------------------
	// ボリュームの取得
	// 戻り値：float	現在の大きさ
	//-------------------------------------------------------------
	float GetVolume();

private:

	//-------------------------------------------------------------
	// ファイル読み込み
	//-------------------------------------------------------------
	void ReadFile(string name);

	//-------------------------------------------------------------
	// バッファの生成
	// 引　数：const int バッファカウント
	// 　　　：const int バッファの長さ
	//-------------------------------------------------------------
	void CreateBuffer(const int bufferCnt, const int bufferLen);

	//-------------------------------------------------------------
	// バッファの設定
	//-------------------------------------------------------------
	void SetBuffer();

	IXAudio2* m_pXAudio2;
	IXAudio2SourceVoice* m_pSource;
	XAUDIO2_BUFFER m_pBuffer;
	WAVEFORMATEX m_fmt;
	BYTE* m_pBuf[2];
	HMMIO m_mmio;
	size_t m_loaded;
	size_t m_chunkSize;
	size_t m_loopPoint;
	int bufCnt;
};