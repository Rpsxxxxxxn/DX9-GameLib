//********************************************************************************
//
// PlayerCamera.hpp
//
// プレイヤーカメラ
//
// Date: 2019/07/30 更新
//
//********************************************************************************

#pragma once

//================================================================================
// インクルード
//================================================================================
#include "../../GameManager/GameManager.h"
#include "../Player/Player.hpp"

//================================================================================
// クラス定義
//================================================================================
class CPlayerCamera : public CGameObject
{
public:

	//--------------------------------------------------------------------------------
	// コンストラクタ
	//--------------------------------------------------------------------------------
	CPlayerCamera();

	//--------------------------------------------------------------------------------
	// デストラクタ
	//--------------------------------------------------------------------------------
	~CPlayerCamera();

	//--------------------------------------------------------------------------------
	// ファイル読み込み
	// 引　数：CSystem*	システムクラスのポインタ
	//--------------------------------------------------------------------------------
	void LoadFile(CSystem* pSystem);

	//--------------------------------------------------------------------------------
	// 初期化
	// 引　数：CSystem*	システムクラスのポインタ
	//--------------------------------------------------------------------------------
	void Initialize(CSystem* pSystem);

	//--------------------------------------------------------------------------------
	// 更新
	// 引　数：CSystem*	システムクラスのポインタ
	// 　　　　CPlayer*	プレイヤークラスのポインタ
	//--------------------------------------------------------------------------------
	void Update(CSystem* pSystem, CPlayer* pPlayer, const float lockAngle);

	//--------------------------------------------------------------------------------
	// カメラパラメータの再計算
	//--------------------------------------------------------------------------------
	void RecalcCameraParams();

	//--------------------------------------------------------------------------------
	// レイの取得
	// 戻り値：CRay*	レイの取得
	//--------------------------------------------------------------------------------
	CRay* GetRay() const { return m_pRay; };

	//--------------------------------------------------------------------------------
	// カメラクラスの取得
	// 戻り値：CCamera*	カメラクラスのポインタ
	//--------------------------------------------------------------------------------
	CCamera* GetCamera() const { return m_pCamera; };

	//--------------------------------------------------------------------------------
	// 投影行列の取得
	// 戻り値：Matrix	投影行列
	//--------------------------------------------------------------------------------
	Matrix GetProjectionMatrix() const { return m_pCamera->GetProjectionMatrix(); };

	//--------------------------------------------------------------------------------
	// 方向の取得
	// 戻り値：const Vector3	方向
	//--------------------------------------------------------------------------------
	Vector3 GetAngle() const { return m_vecRotDelay; };

private:

	//--------------------------------------------------------------------------------
	// 位置の更新
	//--------------------------------------------------------------------------------
	void UpdatePosition();

	//--------------------------------------------------------------------------------
	// プレイヤーに注目する
	// 引　数：CPlayer*	プレイヤークラスのポインタ
	//--------------------------------------------------------------------------------
	void UpdateLookAtPlayer(CPlayer* pPlayer);

	//--------------------------------------------------------------------------------
	// キー入力
	// 引　数：CSystem*	システムクラスのポインタ
	//--------------------------------------------------------------------------------
	void UpdateKeyInput(CSystem* pSystem);

	//--------------------------------------------------------------------------------
	// カメラ操作
	// 引　数：CPlayer*	プレイヤークラスのポインタ
	//--------------------------------------------------------------------------------
	void UpdateController(CPlayer* pPlayer);

	//--------------------------------------------------------------------------------
	// ダッシュ中のカメラの揺れ
	// 引　数：CPlayer*	プレイヤークラスのポインタ
	//--------------------------------------------------------------------------------
	void UpdateDashShake(CPlayer* pPlayer);

	//--------------------------------------------------------------------------------
	// ロックオン
	//--------------------------------------------------------------------------------
	void UpdateLockOnSystem(CPlayer* pPlayer, const float angle);

	//--------------------------------------------------------------------------------
	// カメラのパラメータ設定
	//--------------------------------------------------------------------------------
	void SetCameraParams();

	CCamera* m_pCamera;
	CRay* m_pRay;

	Vector3 m_vecPosDelay;
	Vector3 m_vecRotDelay;

	float m_shake;
	float m_fov;
	float m_fovDelay;
};