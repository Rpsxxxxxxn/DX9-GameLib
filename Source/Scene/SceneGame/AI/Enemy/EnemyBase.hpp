//********************************************************************************
//
// EnemyBase.hpp
//
// オブジェクトクラスのテンプレート
//
// Date: 2019/07/30 更新
//
//********************************************************************************

#pragma once

//================================================================================
// インクルード
//================================================================================
#include "../../../GameManager/GameManager.h"
#include "../../Hud/Damage/Damage.hpp"
#include "../../Player/Player.hpp"

//================================================================================
// クラス定義
//================================================================================
class CEnemyBase : public CGameObject
{
public:

	//--------------------------------------------------------------------------------
	// コンストラクタ
	//--------------------------------------------------------------------------------
	CEnemyBase();

	//--------------------------------------------------------------------------------
	// デストラクタ
	//--------------------------------------------------------------------------------
	~CEnemyBase();

	//--------------------------------------------------------------------------------
	// 初期化
	// 引　数：CSystem*	システムクラスのポインタ
	//--------------------------------------------------------------------------------
	virtual void Initialize(CSystem* pSystem) = 0;

	//--------------------------------------------------------------------------------
	// 更新
	// 引　数：CSystem*	システムクラスのポインタ
	// 　　　　CPlayer*	プレイヤークラスのポインタ
	//--------------------------------------------------------------------------------
	virtual void Update(CSystem* pSystem, CPlayer* pPlayer);

	//--------------------------------------------------------------------------------
	// 描画
	// 引　数：CSystem*	システムクラスのポインタ
	//--------------------------------------------------------------------------------
	void ZDraw(CSystem* pSystem);

	//--------------------------------------------------------------------------------
	// 描画
	// 引　数：CSystem*	システムクラスのポインタ
	//--------------------------------------------------------------------------------
	void Draw(CSystem* pSystem);

	//--------------------------------------------------------------------------------
	// 出現時の位置(ランダム化)
	// 引　数：const float	範囲(半径)
	//--------------------------------------------------------------------------------
	void SpawnRandomPos(const float radius);

	//--------------------------------------------------------------------------------
	// ヒットした時HPを減らす
	// 引　数：const float	攻撃力
	//--------------------------------------------------------------------------------
	void SetHitPlayerAttack(CSystem* pSystem, CShowDamage* pDamage, const float atk);

	//--------------------------------------------------------------------------------
	// プレイヤー攻撃アニメーションが終了した時
	//--------------------------------------------------------------------------------
	void SetHitReset();

	//--------------------------------------------------------------------------------
	// プレイヤーへの攻撃が当たったとき
	// 備　考：これは一度きりの攻撃をさせることをする
	//--------------------------------------------------------------------------------
	void SetPlayerHit();

	//--------------------------------------------------------------------------------
	// 現在の攻撃アニメーション状況
	// 戻り値：const bool	攻撃アニメーションが有効かどうか
	//--------------------------------------------------------------------------------
	bool IsAttackAni() const { return m_isAttackFlg; };

	//--------------------------------------------------------------------------------
	// 体の当たり判定
	// 戻り値：CBoundingBox*	バウンディングボックス
	//--------------------------------------------------------------------------------
	CBoundingBox* GetBodyBox() const { return m_pBodyBox; };

	//--------------------------------------------------------------------------------
	// 攻撃用当たり判定
	// 戻り値：CBoundingBox*	バウンディングボックス
	//--------------------------------------------------------------------------------
	CBoundingBox* GetAttackBox() const { return m_pAttackBox; };

	//--------------------------------------------------------------------------------
	// レイの取得
	//--------------------------------------------------------------------------------
	CRay* GetRay() const { return m_pRay; };

	//--------------------------------------------------------------------------------
	// 攻撃力の取得
	//--------------------------------------------------------------------------------
	float GetAtk() const { return m_atk; };

protected:

	//--------------------------------------------------------------------------------
	// 死亡状況の更新
	//--------------------------------------------------------------------------------
	void UpdateDeath();

	//--------------------------------------------------------------------------------
	// 世界行列の更新
	//--------------------------------------------------------------------------------
	void UpdateMatrix();

	//--------------------------------------------------------------------------------
	// 位置の更新
	//--------------------------------------------------------------------------------
	void UpdatePosition();

	//--------------------------------------------------------------------------------
	// 体のバウンディングボックス生成
	//--------------------------------------------------------------------------------
	void CreateBodyBox(CSystem* pSystem, const Vector3 vecMax, const Vector3 vecMin);

	//--------------------------------------------------------------------------------
	// 攻撃のバウンディングボックス生成
	//--------------------------------------------------------------------------------
	void CreateAttackBox(CSystem* pSystem, const Vector3 vecMax, const Vector3 vecMin);

	//--------------------------------------------------------------------------------
	// 前方向の更新
	//--------------------------------------------------------------------------------
	void UpdateForward(const Vector3 vecForward);

	//--------------------------------------------------------------------------------
	// パラメータの取得
	// 引　数：const string ファイル名
	//--------------------------------------------------------------------------------
	void LoadParams(const string strFileName);

	//--------------------------------------------------------------------------------
	// パラメータの保存
	// 引　数：const string ファイル名
	//--------------------------------------------------------------------------------
	void InitParams(const string strFileName);

	CIntervalTimer m_timer;
	CXFileModel* m_pModel;
	CBoundingBox* m_pBodyBox;
	CBoundingBox* m_pAttackBox;
	CRay* m_pRay;

	Vector3 m_vecBasePos;
	Vector3 m_vecForward;
	Vector3 m_vecMovement;

	double m_attackStartTime;
	double m_deathStartTime;
	double m_attackTimer;
	double m_attackInterval;

	UINT m_nowAnimation;

	float m_distLimit;
	float m_distance;
	float m_hp;
	float m_atk;
	float m_walkSpeed;
	float m_dashSpeed;
	float m_longDist;
	float m_intermediateDist;
	float m_shortDist;
	float m_rotateSpd;
	float m_meshAlpha;

	bool m_isDiscovery;
	bool m_isDeath;
	bool m_isHit; //プレイヤーからのダメージ
	bool m_isHitPlayer; //自分自身の攻撃
	bool m_isAttackFlg;
	bool m_isNowAttack;
};